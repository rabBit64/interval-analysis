/* Generated by CIL v. 1.7.3 */
/* print_CIL_Input is false */

#line 211 "/usr/lib/gcc/x86_64-linux-gnu/4.4.1/include/stddef.h"
typedef unsigned long size_t;
#line 3 "/home/wslee/projects/uav/test/nlkain-1.3/src-C/nonlinear_krylov_accelerator.h"
struct nka_state;
#line 3 "/home/wslee/projects/uav/test/nlkain-1.3/src-C/nonlinear_krylov_accelerator.h"
typedef struct nka_state *NKA;
#line 63 "/home/wslee/projects/uav/test/nlkain-1.3/src-C/nka_c_test.c"
struct __anonstruct_SYSTEM_24 {
   int nx ;
   int ny ;
   double a ;
   double hx ;
   double hy ;
   double *ax ;
   double *ay ;
   double *ac ;
   double *q ;
   NKA nka ;
};
#line 63 "/home/wslee/projects/uav/test/nlkain-1.3/src-C/nka_c_test.c"
typedef struct __anonstruct_SYSTEM_24 SYSTEM;
#line 167 "/home/wslee/projects/uav/test/nlkain-1.3/src-C/nonlinear_krylov_accelerator.c"
struct nka_state {
   int subspace ;
   int pending ;
   int vsize ;
   int mvec ;
   double vtol ;
   double **v ;
   double **w ;
   double **h ;
   int first ;
   int last ;
   int free ;
   int *next ;
   int *prev ;
   double (*dp)(int  , double * , double * ) ;
};
#line 471 "/usr/include/stdlib.h"
extern  __attribute__((__nothrow__)) void *malloc(size_t __size )  __attribute__((__malloc__)) ;
#line 488
extern  __attribute__((__nothrow__)) void free(void *__ptr ) ;
#line 339 "/usr/include/stdio.h"
extern int printf(char const   * __restrict  __format  , ...) ;
#line 154 "/usr/include/bits/mathcalls.h"
extern  __attribute__((__nothrow__)) double pow(double __x , double __y ) ;
#line 157
extern  __attribute__((__nothrow__)) double sqrt(double __x ) ;
#line 4 "/home/wslee/projects/uav/test/nlkain-1.3/src-C/nonlinear_krylov_accelerator.h"
NKA nka_create(int vsize , int maxv , double vtol , double (*dp)(int  , double * ,
                                                                 double * ) ) ;
#line 5
void nka_destroy(NKA state ) ;
#line 6
void nka_correction(NKA state , double *f ) ;
#line 70 "/home/wslee/projects/uav/test/nlkain-1.3/src-C/nka_c_test.c"
void solve(SYSTEM *sys , int nsweep , double omega , int use_nka , double *sol ) ;
#line 71
void residual(SYSTEM *sys , double *upad , double *r ) ;
#line 72
void update_system(SYSTEM *sys , double *upad ) ;
#line 73
void ssor_pc(SYSTEM *sys , int nsweep , double omega , double *r ) ;
#line 74
double l2norm(double *x , int len ) ;
#line 77 "/home/wslee/projects/uav/test/nlkain-1.3/src-C/nka_c_test.c"
int main(void) 
{ 
  int N ;
  double A ;
  int i ;
  int nsweep ;
  double omega ;
  SYSTEM sys ;
  double *u ;
  void *tmp ;
  void *tmp___0 ;
  void *tmp___1 ;
  void *tmp___2 ;
  void *tmp___3 ;

  {
  {
#line 79
  N = 50;
#line 80
  A = 0.02;
#line 81
  nsweep = 2;
#line 82
  omega = 1.4;
#line 87
  sys.a = A;
#line 88
  sys.nx = N;
#line 89
  sys.ny = N;
#line 90
  sys.hx = 1.0 / (double )sys.nx;
#line 91
  sys.hy = 1.0 / (double )sys.ny;
  {
#line 92
  tmp = malloc((unsigned long )(sys.ny * (sys.nx + 1)) * sizeof(double ));
  }
#line 92
  sys.ax = (double *)tmp;
  {
#line 93
  tmp___0 = malloc((unsigned long )(sys.nx * (sys.ny + 1)) * sizeof(double ));
  }
#line 93
  sys.ay = (double *)tmp___0;
  {
#line 94
  tmp___1 = malloc((unsigned long )(sys.nx * sys.ny) * sizeof(double ));
  }
#line 94
  sys.ac = (double *)tmp___1;
  {
#line 95
  tmp___2 = malloc((unsigned long )(sys.nx * sys.ny) * sizeof(double ));
  }
#line 95
  sys.q = (double *)tmp___2;
  {
#line 96
  sys.nka = nka_create(sys.nx * sys.ny, 5, 0.01, (double (*)(int  , double * , double * ))((void *)0));
  }
#line 98
  i = 0;
  }
  {
  {
#line 98
  while (1) {
    while_continue___0: /* CIL Label */ ;
    while_continue: /* CIL Label */ ;
#line 98
    if (! (i < sys.nx * sys.ny)) {
#line 98
      goto while_break;
    }
#line 98
    *(sys.q + i) = sys.hx * sys.hy;
#line 98
    i ++;
  }
  while_break___0: /* CIL Label */ ;
  }
  while_break: /* CIL Label */ ;
  }
  {
  {
#line 101
  tmp___3 = malloc((unsigned long )(sys.nx * sys.ny) * sizeof(double ));
  }
#line 101
  u = (double *)tmp___3;
  {
#line 102
  solve(& sys, nsweep, omega, 1, u);
  }
  {
#line 103
  solve(& sys, nsweep, omega, 0, u);
  }
  {
#line 104
  nka_destroy(sys.nka);
  }
  }
#line 106
  return (0);
}
}
#line 110 "/home/wslee/projects/uav/test/nlkain-1.3/src-C/nka_c_test.c"
void solve(SYSTEM *sys , int nsweep , double omega , int use_nka , double *sol ) 
{ 
  int i ;
  int j ;
  int k ;
  int n ;
  int nx ;
  int ny ;
  int itr ;
  double *upad ;
  double *u ;
  double *r ;
  double *t ;
  double rnorm0 ;
  double rnorm ;
  double red ;
  double rate ;
  int MAXITR ;
  double TOL ;
  void *tmp ;
  void *tmp___0 ;
  char *__cil_tmp25 ;
  char *__cil_tmp26 ;
  char *__cil_tmp27 ;
  char *__cil_tmp28 ;
  char *__cil_tmp29 ;

  {
#line 115
  MAXITR = 999;
#line 116
  TOL = 1.0e-6;
#line 118
  if (use_nka) {
    {
    {
#line 119
    printf((char const   */* __restrict  */)"\nACCELERATED SOLVE\n\n");
    }
    }
  } else {
    {
    {
#line 121
    printf((char const   */* __restrict  */)"\nUNACCELERATED SOLVE\n\n");
    }
    }
  }
  {
  {
#line 123
  printf((char const   */* __restrict  */)"Iter Residual Norm    Reduction    Rate\n");
  }
#line 125
  nx = sys->nx;
#line 126
  ny = sys->ny;
#line 128
  n = (nx + 2) * (ny + 2);
  {
#line 129
  tmp = malloc((unsigned long )n * sizeof(double ));
  }
#line 129
  upad = (double *)tmp;
#line 130
  i = 0;
  }
  {
  {
#line 130
  while (1) {
    while_continue___5: /* CIL Label */ ;
    while_continue: /* CIL Label */ ;
#line 130
    if (! (i < n)) {
#line 130
      goto while_break;
    }
#line 130
    *(upad + i) = 0.0;
#line 130
    i ++;
  }
  while_break___5: /* CIL Label */ ;
  }
  while_break: /* CIL Label */ ;
  }
  {
  {
#line 132
  tmp___0 = malloc((unsigned long )(nx * ny) * sizeof(double ));
  }
#line 132
  r = (double *)tmp___0;
  {
#line 134
  residual(sys, upad, r);
  }
  {
#line 135
  rnorm0 = l2norm(r, nx * ny);
  }
  {
#line 136
  printf((char const   */* __restrict  */)"%3d:%14.6E\n", 0, rnorm0);
  }
#line 138
  itr = 1;
  }
  {
  {
#line 138
  while (1) {
    while_continue___6: /* CIL Label */ ;
    while_continue___0: /* CIL Label */ ;
#line 138
    if (! (itr <= MAXITR)) {
#line 138
      goto while_break___0;
    }
    {
    {
#line 139
    ssor_pc(sys, nsweep, omega, r);
    }
    }
#line 140
    if (use_nka) {
      {
      {
#line 140
      nka_correction(sys->nka, r);
      }
      }
    }
#line 143
    t = r;
#line 144
    u = upad + (nx + 2);
#line 145
    k = 0;
    {
    {
#line 145
    while (1) {
      while_continue___7: /* CIL Label */ ;
      while_continue___1: /* CIL Label */ ;
#line 145
      if (! (k < ny)) {
#line 145
        goto while_break___1;
      }
#line 146
      u ++;
#line 147
      j = 0;
      {
      {
#line 147
      while (1) {
        while_continue___8: /* CIL Label */ ;
        while_continue___2: /* CIL Label */ ;
#line 147
        if (! (j < nx)) {
#line 147
          goto while_break___2;
        }
#line 148
        *u -= *t;
#line 149
        u ++;
#line 150
        t ++;
#line 147
        j ++;
      }
      while_break___8: /* CIL Label */ ;
      }
      while_break___2: /* CIL Label */ ;
      }
#line 152
      u ++;
#line 145
      k ++;
    }
    while_break___7: /* CIL Label */ ;
    }
    while_break___1: /* CIL Label */ ;
    }
    {
    {
#line 155
    residual(sys, upad, r);
    }
    {
#line 156
    rnorm = l2norm(r, nx * ny);
    }
#line 157
    red = rnorm / rnorm0;
    {
#line 158
    rate = pow(red, 1.0 / (double )itr);
    }
    {
#line 159
    printf((char const   */* __restrict  */)"%3d:%14.6E%13.3E%8.3f\n", itr, rnorm,
           red, rate);
    }
    }
#line 160
    if (rnorm < TOL * rnorm0) {
#line 160
      goto while_break___0;
    }
#line 138
    itr ++;
  }
  while_break___6: /* CIL Label */ ;
  }
  while_break___0: /* CIL Label */ ;
  }
#line 164
  u = upad + (nx + 2);
#line 165
  k = 0;
  {
  {
#line 165
  while (1) {
    while_continue___9: /* CIL Label */ ;
    while_continue___3: /* CIL Label */ ;
#line 165
    if (! (k < ny)) {
#line 165
      goto while_break___3;
    }
#line 166
    u ++;
#line 167
    j = 0;
    {
    {
#line 167
    while (1) {
      while_continue___10: /* CIL Label */ ;
      while_continue___4: /* CIL Label */ ;
#line 167
      if (! (j < nx)) {
#line 167
        goto while_break___4;
      }
#line 168
      *sol = *u;
#line 169
      u ++;
#line 170
      sol ++;
#line 167
      j ++;
    }
    while_break___10: /* CIL Label */ ;
    }
    while_break___4: /* CIL Label */ ;
    }
#line 172
    u ++;
#line 165
    k ++;
  }
  while_break___9: /* CIL Label */ ;
  }
  while_break___3: /* CIL Label */ ;
  }
#line 174
  return;
}
}
#line 177 "/home/wslee/projects/uav/test/nlkain-1.3/src-C/nka_c_test.c"
void residual(SYSTEM *sys , double *upad , double *r ) 
{ 
  int j ;
  int k ;
  int nx ;
  int ny ;
  double *u ;
  double *ac ;
  double *ax ;
  double *ay ;
  double *q ;

  {
  {
  {
#line 182
  update_system(sys, upad);
  }
#line 184
  nx = sys->nx;
#line 185
  ny = sys->ny;
#line 187
  ac = sys->ac;
#line 188
  ax = sys->ax;
#line 189
  ay = sys->ay;
#line 190
  q = sys->q;
#line 191
  u = upad + (nx + 2);
#line 192
  k = 0;
  }
  {
  {
#line 192
  while (1) {
    while_continue___1: /* CIL Label */ ;
    while_continue: /* CIL Label */ ;
#line 192
    if (! (k < ny)) {
#line 192
      goto while_break;
    }
#line 193
    u ++;
#line 194
    j = 0;
    {
    {
#line 194
    while (1) {
      while_continue___2: /* CIL Label */ ;
      while_continue___0: /* CIL Label */ ;
#line 194
      if (! (j < nx)) {
#line 194
        goto while_break___0;
      }
#line 195
      *(r + 0) = ((((*(ac + 0) * *(u + 0) - *(ax + 0) * *(u + -1)) - *(ax + 1) * *(u + 1)) - *(ay + 0) * *(u + (- nx - 2))) - *(ay + nx) * *(u + (nx + 2))) - *(q + 0);
#line 196
      r ++;
#line 197
      u ++;
#line 198
      q ++;
#line 199
      ac ++;
#line 200
      ax ++;
#line 201
      ay ++;
#line 194
      j ++;
    }
    while_break___2: /* CIL Label */ ;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 203
    u ++;
#line 204
    ax ++;
#line 192
    k ++;
  }
  while_break___1: /* CIL Label */ ;
  }
  while_break: /* CIL Label */ ;
  }
#line 207
  return;
}
}
#line 210 "/home/wslee/projects/uav/test/nlkain-1.3/src-C/nka_c_test.c"
void update_system(SYSTEM *sys , double *upad ) 
{ 
  int i ;
  int j ;
  int k ;
  int nx ;
  int ny ;
  double rx ;
  double ry ;
  double t ;
  double *u ;
  double *ax ;
  double *ay ;
  double *ac ;

  {
#line 216
  nx = sys->nx;
#line 217
  ny = sys->ny;
#line 219
  rx = sys->hx / sys->hy;
#line 220
  ry = sys->hy / sys->hx;
#line 222
  i = 0;
  {
  {
#line 222
  while (1) {
    while_continue___7: /* CIL Label */ ;
    while_continue: /* CIL Label */ ;
#line 222
    if (! (i < ny * (nx + 1))) {
#line 222
      goto while_break;
    }
#line 223
    *(sys->ax + i) = 0.0;
#line 222
    i ++;
  }
  while_break___7: /* CIL Label */ ;
  }
  while_break: /* CIL Label */ ;
  }
#line 225
  i = 0;
  {
  {
#line 225
  while (1) {
    while_continue___8: /* CIL Label */ ;
    while_continue___0: /* CIL Label */ ;
#line 225
    if (! (i < nx * (ny + 1))) {
#line 225
      goto while_break___0;
    }
#line 226
    *(sys->ay + i) = 0.0;
#line 225
    i ++;
  }
  while_break___8: /* CIL Label */ ;
  }
  while_break___0: /* CIL Label */ ;
  }
#line 229
  ax = sys->ax;
#line 230
  ay = sys->ay;
#line 231
  u = upad + (nx + 2);
#line 232
  k = 0;
  {
  {
#line 232
  while (1) {
    while_continue___9: /* CIL Label */ ;
    while_continue___1: /* CIL Label */ ;
#line 232
    if (! (k < ny)) {
#line 232
      goto while_break___1;
    }
#line 233
    u ++;
#line 234
    j = 0;
    {
    {
#line 234
    while (1) {
      while_continue___10: /* CIL Label */ ;
      while_continue___2: /* CIL Label */ ;
#line 234
      if (! (j < nx)) {
#line 234
        goto while_break___2;
      }
#line 235
      t = 1.0 / (sys->a + *(u + 0));
#line 236
      *(ax + 0) += rx * t;
#line 237
      *(ax + 1) += rx * t;
#line 238
      *(ay + 0) += ry * t;
#line 239
      *(ay + nx) += ry * t;
#line 240
      ax ++;
#line 241
      ay ++;
#line 242
      u ++;
#line 234
      j ++;
    }
    while_break___10: /* CIL Label */ ;
    }
    while_break___2: /* CIL Label */ ;
    }
#line 244
    u ++;
#line 245
    ax ++;
#line 232
    k ++;
  }
  while_break___9: /* CIL Label */ ;
  }
  while_break___1: /* CIL Label */ ;
  }
#line 248
  i = 0;
  {
  {
#line 248
  while (1) {
    while_continue___11: /* CIL Label */ ;
    while_continue___3: /* CIL Label */ ;
#line 248
    if (! (i < ny * (nx + 1))) {
#line 248
      goto while_break___3;
    }
#line 249
    *(sys->ax + i) = 2.0 / *(sys->ax + i);
#line 248
    i ++;
  }
  while_break___11: /* CIL Label */ ;
  }
  while_break___3: /* CIL Label */ ;
  }
#line 252
  i = 0;
  {
  {
#line 252
  while (1) {
    while_continue___12: /* CIL Label */ ;
    while_continue___4: /* CIL Label */ ;
#line 252
    if (! (i < nx * (ny + 1))) {
#line 252
      goto while_break___4;
    }
#line 253
    *(sys->ay + i) = 2.0 / *(sys->ay + i);
#line 252
    i ++;
  }
  while_break___12: /* CIL Label */ ;
  }
  while_break___4: /* CIL Label */ ;
  }
#line 256
  ac = sys->ac;
#line 257
  ax = sys->ax;
#line 258
  ay = sys->ay;
#line 259
  k = 0;
  {
  {
#line 259
  while (1) {
    while_continue___13: /* CIL Label */ ;
    while_continue___5: /* CIL Label */ ;
#line 259
    if (! (k < ny)) {
#line 259
      goto while_break___5;
    }
#line 260
    j = 0;
    {
    {
#line 260
    while (1) {
      while_continue___14: /* CIL Label */ ;
      while_continue___6: /* CIL Label */ ;
#line 260
      if (! (j < nx)) {
#line 260
        goto while_break___6;
      }
#line 261
      *(ac + 0) = ((*(ax + 0) + *(ax + 1)) + *(ay + 0)) + *(ay + nx);
#line 262
      ac ++;
#line 263
      ax ++;
#line 264
      ay ++;
#line 260
      j ++;
    }
    while_break___14: /* CIL Label */ ;
    }
    while_break___6: /* CIL Label */ ;
    }
#line 266
    ax ++;
#line 259
    k ++;
  }
  while_break___13: /* CIL Label */ ;
  }
  while_break___5: /* CIL Label */ ;
  }
#line 268
  return;
}
}
#line 271 "/home/wslee/projects/uav/test/nlkain-1.3/src-C/nka_c_test.c"
void ssor_pc(SYSTEM *sys , int nsweep , double omega , double *r ) 
{ 
  int i ;
  int j ;
  int k ;
  int n ;
  int nx ;
  int ny ;
  double *ac ;
  double *ax ;
  double *ay ;
  double *zpad ;
  double *z ;
  void *tmp ;

  {
  {
#line 276
  nx = sys->nx;
#line 277
  ny = sys->ny;
#line 279
  n = (nx + 2) * (ny + 2);
  {
#line 280
  tmp = malloc((unsigned long )n * sizeof(double ));
  }
#line 280
  zpad = (double *)tmp;
#line 281
  i = 0;
  }
  {
  {
#line 281
  while (1) {
    while_continue___7: /* CIL Label */ ;
    while_continue: /* CIL Label */ ;
#line 281
    if (! (i < n)) {
#line 281
      goto while_break;
    }
#line 281
    *(zpad + i) = 0.0;
#line 281
    i ++;
  }
  while_break___7: /* CIL Label */ ;
  }
  while_break: /* CIL Label */ ;
  }
#line 283
  ac = sys->ac;
#line 284
  ax = sys->ax;
#line 285
  ay = sys->ay;
#line 286
  z = zpad + (nx + 2);
#line 288
  i = 0;
  {
  {
#line 288
  while (1) {
    while_continue___8: /* CIL Label */ ;
    while_continue___0: /* CIL Label */ ;
#line 288
    if (! (i < nsweep)) {
#line 288
      goto while_break___0;
    }
#line 290
    k = 0;
    {
    {
#line 290
    while (1) {
      while_continue___9: /* CIL Label */ ;
      while_continue___1: /* CIL Label */ ;
#line 290
      if (! (k < ny)) {
#line 290
        goto while_break___1;
      }
#line 291
      z ++;
#line 292
      j = 0;
      {
      {
#line 292
      while (1) {
        while_continue___10: /* CIL Label */ ;
        while_continue___2: /* CIL Label */ ;
#line 292
        if (! (j < nx)) {
#line 292
          goto while_break___2;
        }
#line 293
        *(z + 0) = (1.0 - omega) * *(z + 0) + (omega * ((((*(r + 0) + *(ax + 0) * *(z + -1)) + *(ax + 1) * *(z + 1)) + *(ay + 0) * *(z + (- nx - 2))) + *(ay + nx) * *(z + (nx + 2)))) / *(ac + 0);
#line 296
        z ++;
#line 297
        r ++;
#line 298
        ac ++;
#line 299
        ax ++;
#line 300
        ay ++;
#line 292
        j ++;
      }
      while_break___10: /* CIL Label */ ;
      }
      while_break___2: /* CIL Label */ ;
      }
#line 302
      z ++;
#line 303
      ax ++;
#line 290
      k ++;
    }
    while_break___9: /* CIL Label */ ;
    }
    while_break___1: /* CIL Label */ ;
    }
#line 306
    k = 0;
    {
    {
#line 306
    while (1) {
      while_continue___11: /* CIL Label */ ;
      while_continue___3: /* CIL Label */ ;
#line 306
      if (! (k < ny)) {
#line 306
        goto while_break___3;
      }
#line 307
      z --;
#line 308
      ax --;
#line 309
      j = 0;
      {
      {
#line 309
      while (1) {
        while_continue___12: /* CIL Label */ ;
        while_continue___4: /* CIL Label */ ;
#line 309
        if (! (j < nx)) {
#line 309
          goto while_break___4;
        }
#line 310
        z --;
#line 311
        r --;
#line 312
        ac --;
#line 313
        ax --;
#line 314
        ay --;
#line 315
        *(z + 0) = (1.0 - omega) * *(z + 0) + (omega * ((((*(r + 0) + *(ax + 0) * *(z + -1)) + *(ax + 1) * *(z + 1)) + *(ay + 0) * *(z + (- nx - 2))) + *(ay + nx) * *(z + (nx + 2)))) / *(ac + 0);
#line 309
        j ++;
      }
      while_break___12: /* CIL Label */ ;
      }
      while_break___4: /* CIL Label */ ;
      }
#line 319
      z --;
#line 306
      k ++;
    }
    while_break___11: /* CIL Label */ ;
    }
    while_break___3: /* CIL Label */ ;
    }
#line 288
    i ++;
  }
  while_break___8: /* CIL Label */ ;
  }
  while_break___0: /* CIL Label */ ;
  }
#line 324
  k = 0;
  {
  {
#line 324
  while (1) {
    while_continue___13: /* CIL Label */ ;
    while_continue___5: /* CIL Label */ ;
#line 324
    if (! (k < ny)) {
#line 324
      goto while_break___5;
    }
#line 325
    z ++;
#line 326
    j = 0;
    {
    {
#line 326
    while (1) {
      while_continue___14: /* CIL Label */ ;
      while_continue___6: /* CIL Label */ ;
#line 326
      if (! (j < nx)) {
#line 326
        goto while_break___6;
      }
#line 327
      *r = *z;
#line 328
      r ++;
#line 329
      z ++;
#line 326
      j ++;
    }
    while_break___14: /* CIL Label */ ;
    }
    while_break___6: /* CIL Label */ ;
    }
#line 331
    z ++;
#line 324
    k ++;
  }
  while_break___13: /* CIL Label */ ;
  }
  while_break___5: /* CIL Label */ ;
  }
  {
  {
#line 333
  free((void *)zpad);
  }
  }
#line 334
  return;
}
}
#line 337 "/home/wslee/projects/uav/test/nlkain-1.3/src-C/nka_c_test.c"
double l2norm(double *x , int len ) 
{ 
  int i ;
  double a ;
  double tmp ;

  {
#line 341
  a = 0.0;
#line 342
  i = 0;
  {
  {
#line 342
  while (1) {
    while_continue___0: /* CIL Label */ ;
    while_continue: /* CIL Label */ ;
#line 342
    if (! (i < len)) {
#line 342
      goto while_break;
    }
#line 343
    a += *(x + i) * *(x + i);
#line 342
    i ++;
  }
  while_break___0: /* CIL Label */ ;
  }
  while_break: /* CIL Label */ ;
  }
  {
  {
#line 345
  tmp = sqrt(a);
  }
  }
#line 345
  return (tmp);
}
}
#line 7 "/home/wslee/projects/uav/test/nlkain-1.3/src-C/nonlinear_krylov_accelerator.h"
void nka_restart(NKA state ) ;
#line 8
void nka_relax(NKA state ) ;
#line 188 "/home/wslee/projects/uav/test/nlkain-1.3/src-C/nonlinear_krylov_accelerator.c"
double dot_product(int len , double *a , double *b ) 
{ 
  int j ;
  double s ;

  {
#line 193
  s = 0.0;
#line 193
  j = 0;
  {
  {
#line 193
  while (1) {
    while_continue___0: /* CIL Label */ ;
    while_continue: /* CIL Label */ ;
#line 193
    if (! (j < len)) {
#line 193
      goto while_break;
    }
#line 194
    s += *(a + j) * *(b + j);
#line 193
    j ++;
  }
  while_break___0: /* CIL Label */ ;
  }
  while_break: /* CIL Label */ ;
  }
#line 195
  return (s);
}
}
#line 199 "/home/wslee/projects/uav/test/nlkain-1.3/src-C/nonlinear_krylov_accelerator.c"
NKA nka_create(int vsize , int maxv , double vtol , double (*dp)(int  , double * ,
                                                                 double * ) ) 
{ 
  int j ;
  int n ;
  NKA state ;
  void *tmp ;
  void *tmp___0 ;
  void *tmp___1 ;
  void *tmp___2 ;
  void *tmp___3 ;
  void *tmp___4 ;
  void *tmp___5 ;
  void *tmp___6 ;
  void *tmp___7 ;

  {
  {
  {
#line 209
  tmp = malloc(sizeof(*state));
  }
#line 209
  state = (NKA )tmp;
#line 211
  state->vsize = vsize;
#line 212
  state->mvec = maxv;
#line 213
  state->vtol = vtol;
  }
#line 215
  if ((unsigned long )dp == (unsigned long )((void *)0)) {
#line 216
    state->dp = & dot_product;
  } else {
#line 218
    state->dp = dp;
  }
  {
#line 221
  n = maxv + 1;
  {
#line 222
  tmp___0 = malloc((unsigned long )n * sizeof(double *));
  }
#line 222
  state->v = (double **)tmp___0;
  {
#line 223
  tmp___1 = malloc((unsigned long )(n * vsize) * sizeof(double ));
  }
#line 223
  *(state->v + 0) = (double *)tmp___1;
#line 224
  j = 1;
  }
  {
  {
#line 224
  while (1) {
    while_continue___2: /* CIL Label */ ;
    while_continue: /* CIL Label */ ;
#line 224
    if (! (j < n)) {
#line 224
      goto while_break;
    }
#line 225
    *(state->v + j) = *(state->v + (j - 1)) + vsize;
#line 224
    j ++;
  }
  while_break___2: /* CIL Label */ ;
  }
  while_break: /* CIL Label */ ;
  }
  {
  {
#line 228
  tmp___2 = malloc((unsigned long )n * sizeof(double *));
  }
#line 228
  state->w = (double **)tmp___2;
  {
#line 229
  tmp___3 = malloc((unsigned long )(n * vsize) * sizeof(double ));
  }
#line 229
  *(state->w + 0) = (double *)tmp___3;
#line 230
  j = 1;
  }
  {
  {
#line 230
  while (1) {
    while_continue___3: /* CIL Label */ ;
    while_continue___0: /* CIL Label */ ;
#line 230
    if (! (j < n)) {
#line 230
      goto while_break___0;
    }
#line 231
    *(state->w + j) = *(state->w + (j - 1)) + vsize;
#line 230
    j ++;
  }
  while_break___3: /* CIL Label */ ;
  }
  while_break___0: /* CIL Label */ ;
  }
  {
  {
#line 234
  tmp___4 = malloc((unsigned long )n * sizeof(double *));
  }
#line 234
  state->h = (double **)tmp___4;
  {
#line 235
  tmp___5 = malloc((unsigned long )(n * n) * sizeof(double ));
  }
#line 235
  *(state->h + 0) = (double *)tmp___5;
#line 236
  j = 1;
  }
  {
  {
#line 236
  while (1) {
    while_continue___4: /* CIL Label */ ;
    while_continue___1: /* CIL Label */ ;
#line 236
    if (! (j < n)) {
#line 236
      goto while_break___1;
    }
#line 237
    *(state->h + j) = *(state->h + (j - 1)) + n;
#line 236
    j ++;
  }
  while_break___4: /* CIL Label */ ;
  }
  while_break___1: /* CIL Label */ ;
  }
  {
  {
#line 240
  tmp___6 = malloc((unsigned long )n * sizeof(int ));
  }
#line 240
  state->next = (int *)tmp___6;
  {
#line 241
  tmp___7 = malloc((unsigned long )n * sizeof(int ));
  }
#line 241
  state->prev = (int *)tmp___7;
  {
#line 243
  nka_restart(state);
  }
  }
#line 245
  return (state);
}
}
#line 249 "/home/wslee/projects/uav/test/nlkain-1.3/src-C/nonlinear_krylov_accelerator.c"
void nka_destroy(NKA state ) 
{ 


  {
#line 251
  if (state->v) {
    {
    {
#line 252
    free((void *)*(state->v + 0));
    }
    {
#line 253
    free((void *)state->v);
    }
    }
  }
#line 256
  if (state->w) {
    {
    {
#line 257
    free((void *)*(state->w + 0));
    }
    {
#line 258
    free((void *)state->w);
    }
    }
  }
#line 261
  if (state->h) {
    {
    {
#line 262
    free((void *)*(state->h + 0));
    }
    {
#line 263
    free((void *)state->h);
    }
    }
  }
  {
  {
#line 266
  free((void *)state->next);
  }
  {
#line 267
  free((void *)state->prev);
  }
  {
#line 269
  free((void *)state);
  }
  }
#line 270
  return;
}
}
#line 273 "/home/wslee/projects/uav/test/nlkain-1.3/src-C/nonlinear_krylov_accelerator.c"
void nka_correction(NKA state , double *f ) 
{ 
  int i ;
  int j ;
  int k ;
  int nvec ;
  int new ;
  double s ;
  double hkk ;
  double hkj ;
  double cj ;
  double *v ;
  double *w ;
  double *hk ;
  double *hj ;
  double *c ;
  double tmp ;
  double tmp___0 ;
  void *tmp___1 ;

  {
#line 279
  if (state->pending) {
#line 280
    w = *(state->w + state->first);
#line 281
    j = 0;
    {
    {
#line 281
    while (1) {
      while_continue___13: /* CIL Label */ ;
      while_continue: /* CIL Label */ ;
#line 281
      if (! (j < state->vsize)) {
#line 281
        goto while_break;
      }
#line 282
      *(w + j) -= *(f + j);
#line 281
      j ++;
    }
    while_break___13: /* CIL Label */ ;
    }
    while_break: /* CIL Label */ ;
    }
    {
    {
#line 283
    tmp = (*(state->dp))(state->vsize, w, w);
    }
    {
#line 283
    s = sqrt(tmp);
    }
    }
#line 284
    if (s == 0.0) {
      {
      {
#line 284
      nka_relax(state);
      }
      }
    }
  }
#line 288
  if (state->pending) {
#line 291
    v = *(state->v + state->first);
#line 292
    j = 0;
    {
    {
#line 292
    while (1) {
      while_continue___14: /* CIL Label */ ;
      while_continue___0: /* CIL Label */ ;
#line 292
      if (! (j < state->vsize)) {
#line 292
        goto while_break___0;
      }
#line 293
      *(v + j) /= s;
#line 294
      *(w + j) /= s;
#line 292
      j ++;
    }
    while_break___14: /* CIL Label */ ;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 298
    k = *(state->next + state->first);
    {
    {
#line 298
    while (1) {
      while_continue___15: /* CIL Label */ ;
      while_continue___1: /* CIL Label */ ;
#line 298
      if (! (k != -1)) {
#line 298
        goto while_break___1;
      }
      {
      {
#line 299
      *(*(state->h + state->first) + k) = (*(state->dp))(state->vsize, w, *(state->w + k));
      }
#line 298
      k = *(state->next + k);
      }
    }
    while_break___15: /* CIL Label */ ;
    }
    while_break___1: /* CIL Label */ ;
    }
#line 321
    nvec = 1;
#line 322
    *(*(state->h + state->first) + state->first) = 1.0;
#line 324
    k = *(state->next + state->first);
    {
    {
#line 324
    while (1) {
      while_continue___16: /* CIL Label */ ;
      while_continue___2: /* CIL Label */ ;
#line 324
      if (! (k != -1)) {
#line 324
        goto while_break___2;
      }
#line 327
      nvec ++;
#line 327
      if (nvec > state->mvec) {
#line 330
        *(state->next + state->last) = state->free;
#line 331
        state->free = k;
#line 332
        state->last = *(state->prev + k);
#line 333
        *(state->next + state->last) = -1;
#line 334
        goto while_break___2;
      }
#line 338
      hk = *(state->h + k);
#line 339
      hkk = 1.0;
#line 340
      j = state->first;
      {
      {
#line 340
      while (1) {
        while_continue___17: /* CIL Label */ ;
        while_continue___3: /* CIL Label */ ;
#line 340
        if (! (j != k)) {
#line 340
          goto while_break___3;
        }
#line 341
        hj = *(state->h + j);
#line 342
        hkj = *(hj + k);
#line 343
        i = state->first;
        {
        {
#line 343
        while (1) {
          while_continue___18: /* CIL Label */ ;
          while_continue___4: /* CIL Label */ ;
#line 343
          if (! (i != j)) {
#line 343
            goto while_break___4;
          }
#line 344
          hkj -= *(hk + i) * *(hj + i);
#line 343
          i = *(state->next + i);
        }
        while_break___18: /* CIL Label */ ;
        }
        while_break___4: /* CIL Label */ ;
        }
#line 345
        hkj /= *(hj + j);
#line 346
        *(hk + j) = hkj;
#line 347
        hkk -= hkj * hkj;
#line 340
        j = *(state->next + j);
      }
      while_break___17: /* CIL Label */ ;
      }
      while_break___3: /* CIL Label */ ;
      }
      {
      {
#line 350
      tmp___0 = pow(state->vtol, (double )2);
      }
      }
#line 350
      if (hkk > tmp___0) {
        {
        {
#line 351
        *(hk + k) = sqrt(hkk);
        }
        }
      } else {
#line 356
        *(state->next + *(state->prev + k)) = *(state->next + k);
#line 357
        if (*(state->next + k) == -1) {
#line 358
          state->last = *(state->prev + k);
        } else {
#line 360
          *(state->prev + *(state->next + k)) = *(state->prev + k);
        }
#line 362
        *(state->next + k) = state->free;
#line 363
        state->free = k;
#line 365
        k = *(state->prev + k);
#line 366
        nvec --;
      }
#line 324
      k = *(state->next + k);
    }
    while_break___16: /* CIL Label */ ;
    }
    while_break___2: /* CIL Label */ ;
    }
#line 371
    state->subspace = 1;
  }
#line 381
  new = state->free;
#line 382
  state->free = *(state->next + state->free);
#line 385
  j = 0;
  {
  {
#line 385
  while (1) {
    while_continue___19: /* CIL Label */ ;
    while_continue___5: /* CIL Label */ ;
#line 385
    if (! (j < state->vsize)) {
#line 385
      goto while_break___5;
    }
#line 386
    *(*(state->w + new) + j) = *(f + j);
#line 385
    j ++;
  }
  while_break___19: /* CIL Label */ ;
  }
  while_break___5: /* CIL Label */ ;
  }
#line 388
  if (state->subspace) {
    {
    {
#line 389
    tmp___1 = malloc((unsigned long )(state->mvec + 1) * sizeof(*c));
    }
#line 389
    c = (double *)tmp___1;
#line 393
    j = state->first;
    }
    {
    {
#line 393
    while (1) {
      while_continue___20: /* CIL Label */ ;
      while_continue___6: /* CIL Label */ ;
#line 393
      if (! (j != -1)) {
#line 393
        goto while_break___6;
      }
      {
      {
#line 394
      cj = (*(state->dp))(state->vsize, f, *(state->w + j));
      }
#line 395
      i = state->first;
      }
      {
      {
#line 395
      while (1) {
        while_continue___21: /* CIL Label */ ;
        while_continue___7: /* CIL Label */ ;
#line 395
        if (! (i != j)) {
#line 395
          goto while_break___7;
        }
#line 396
        cj -= *(*(state->h + j) + i) * *(c + i);
#line 395
        i = *(state->next + i);
      }
      while_break___21: /* CIL Label */ ;
      }
      while_break___7: /* CIL Label */ ;
      }
#line 397
      *(c + j) = cj / *(*(state->h + j) + j);
#line 393
      j = *(state->next + j);
    }
    while_break___20: /* CIL Label */ ;
    }
    while_break___6: /* CIL Label */ ;
    }
#line 400
    j = state->last;
    {
    {
#line 400
    while (1) {
      while_continue___22: /* CIL Label */ ;
      while_continue___8: /* CIL Label */ ;
#line 400
      if (! (j != -1)) {
#line 400
        goto while_break___8;
      }
#line 401
      cj = *(c + j);
#line 402
      i = state->last;
      {
      {
#line 402
      while (1) {
        while_continue___23: /* CIL Label */ ;
        while_continue___9: /* CIL Label */ ;
#line 402
        if (! (i != j)) {
#line 402
          goto while_break___9;
        }
#line 403
        cj -= *(*(state->h + i) + j) * *(c + i);
#line 402
        i = *(state->prev + i);
      }
      while_break___23: /* CIL Label */ ;
      }
      while_break___9: /* CIL Label */ ;
      }
#line 404
      *(c + j) = cj / *(*(state->h + j) + j);
#line 400
      j = *(state->prev + j);
    }
    while_break___22: /* CIL Label */ ;
    }
    while_break___8: /* CIL Label */ ;
    }
#line 407
    k = state->first;
    {
    {
#line 407
    while (1) {
      while_continue___24: /* CIL Label */ ;
      while_continue___10: /* CIL Label */ ;
#line 407
      if (! (k != -1)) {
#line 407
        goto while_break___10;
      }
#line 408
      w = *(state->w + k);
#line 409
      v = *(state->v + k);
#line 410
      j = 0;
      {
      {
#line 410
      while (1) {
        while_continue___25: /* CIL Label */ ;
        while_continue___11: /* CIL Label */ ;
#line 410
        if (! (j < state->vsize)) {
#line 410
          goto while_break___11;
        }
#line 411
        *(f + j) += *(c + k) * (*(v + j) - *(w + j));
#line 410
        j ++;
      }
      while_break___25: /* CIL Label */ ;
      }
      while_break___11: /* CIL Label */ ;
      }
#line 407
      k = *(state->next + k);
    }
    while_break___24: /* CIL Label */ ;
    }
    while_break___10: /* CIL Label */ ;
    }
    {
    {
#line 413
    free((void *)c);
    }
    }
  }
#line 417
  j = 0;
  {
  {
#line 417
  while (1) {
    while_continue___26: /* CIL Label */ ;
    while_continue___12: /* CIL Label */ ;
#line 417
    if (! (j < state->vsize)) {
#line 417
      goto while_break___12;
    }
#line 418
    *(*(state->v + new) + j) = *(f + j);
#line 417
    j ++;
  }
  while_break___26: /* CIL Label */ ;
  }
  while_break___12: /* CIL Label */ ;
  }
#line 421
  *(state->prev + new) = -1;
#line 422
  *(state->next + new) = state->first;
#line 423
  if (state->first == -1) {
#line 424
    state->last = new;
  } else {
#line 426
    *(state->prev + state->first) = new;
  }
#line 428
  state->first = new;
#line 431
  state->pending = 1;
#line 432
  return;
}
}
#line 435 "/home/wslee/projects/uav/test/nlkain-1.3/src-C/nonlinear_krylov_accelerator.c"
void nka_restart(NKA state ) 
{ 
  int k ;

  {
#line 440
  state->first = -1;
#line 441
  state->last = -1;
#line 442
  state->subspace = 0;
#line 443
  state->pending = 0;
#line 446
  state->free = 0;
#line 447
  k = 0;
  {
  {
#line 447
  while (1) {
    while_continue___0: /* CIL Label */ ;
    while_continue: /* CIL Label */ ;
#line 447
    if (! (k < state->mvec)) {
#line 447
      goto while_break;
    }
#line 448
    *(state->next + k) = k + 1;
#line 447
    k ++;
  }
  while_break___0: /* CIL Label */ ;
  }
  while_break: /* CIL Label */ ;
  }
#line 450
  *(state->next + state->mvec) = -1;
#line 451
  return;
}
}
#line 454 "/home/wslee/projects/uav/test/nlkain-1.3/src-C/nonlinear_krylov_accelerator.c"
void nka_relax(NKA state ) 
{ 
  int new ;

  {
#line 458
  if (state->pending) {
#line 461
    new = state->first;
#line 462
    state->first = *(state->next + state->first);
#line 463
    if (state->first == -1) {
#line 464
      state->last = -1;
    } else {
#line 466
      *(state->prev + state->first) = -1;
    }
#line 469
    *(state->next + new) = state->free;
#line 470
    state->free = new;
#line 471
    state->pending = 0;
  }
#line 473
  return;
}
}
