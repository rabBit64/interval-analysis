/* Generated by CIL v. 1.7.3 */
/* print_CIL_Input is false */

#line 106 "/usr/include/getopt.h"
struct option {
   char const   *name ;
   int has_arg ;
   int *flag ;
   int val ;
};
#line 211 "/usr/lib/gcc/i486-linux-gnu/4.4.3/include/stddef.h"
typedef unsigned int size_t;
#line 56 "/usr/include/bits/types.h"
typedef long long __quad_t;
#line 141 "/usr/include/bits/types.h"
typedef long __off_t;
#line 142 "/usr/include/bits/types.h"
typedef __quad_t __off64_t;
#line 150 "/usr/include/bits/types.h"
typedef unsigned int __useconds_t;
#line 45 "/usr/include/stdio.h"
struct _IO_FILE;
#line 49 "/usr/include/stdio.h"
typedef struct _IO_FILE FILE;
#line 180 "/usr/include/libio.h"
typedef void _IO_lock_t;
#line 186 "/usr/include/libio.h"
struct _IO_marker {
   struct _IO_marker *_next ;
   struct _IO_FILE *_sbuf ;
   int _pos ;
};
#line 271 "/usr/include/libio.h"
struct _IO_FILE {
   int _flags ;
   char *_IO_read_ptr ;
   char *_IO_read_end ;
   char *_IO_read_base ;
   char *_IO_write_base ;
   char *_IO_write_ptr ;
   char *_IO_write_end ;
   char *_IO_buf_base ;
   char *_IO_buf_end ;
   char *_IO_save_base ;
   char *_IO_backup_base ;
   char *_IO_save_end ;
   struct _IO_marker *_markers ;
   struct _IO_FILE *_chain ;
   int _fileno ;
   int _flags2 ;
   __off_t _old_offset ;
   unsigned short _cur_column ;
   signed char _vtable_offset ;
   char _shortbuf[1] ;
   _IO_lock_t *_lock ;
   __off64_t _offset ;
   void *__pad1 ;
   void *__pad2 ;
   void *__pad3 ;
   void *__pad4 ;
   size_t __pad5 ;
   int _mode ;
   char _unused2[(15UL * sizeof(int ) - 4UL * sizeof(void *)) - sizeof(size_t )] ;
};
#line 180 "/usr/include/bits/types.h"
typedef int __ssize_t;
#line 110 "/usr/include/sys/types.h"
typedef __ssize_t ssize_t;
#line 27 "/home/wslee/benchmarks/flexloader-0.03/src/main.h"
int debug ;
#line 28
int quiet ;
#line 27 "/home/wslee/benchmarks/flexloader-0.03/src/flexloader.h"
int flex_download_program(char *device , char *rbf_file ) ;
#line 339 "/usr/include/stdio.h"
extern int printf(char const   * __restrict  __format  , ...) ;
#line 543 "/usr/include/stdlib.h"
extern  __attribute__((__nothrow__, __noreturn__)) void exit(int __status ) ;
#line 73 "/usr/include/getopt.h"
extern int optind ;
#line 175
extern  __attribute__((__nothrow__)) int getopt_long(int ___argc , char * const  *___argv ,
                                                     char const   *__shortopts , struct option  const  *__longopts ,
                                                     int *__longind ) ;
#line 41 "/home/wslee/benchmarks/flexloader-0.03/src/main.c"
int debug  =    0;
#line 42 "/home/wslee/benchmarks/flexloader-0.03/src/main.c"
int quiet  =    0;
#line 51 "/home/wslee/benchmarks/flexloader-0.03/src/main.c"
static void print_usage(void) 
{ 
  char *__cil_tmp1 ;

  {
  {
  {
#line 53
  printf((char const   */* __restrict  */)"Usage: flexloader parport_device rbf_file\n\nValid options are:\n  -d,       --debug             Print debug messages.\n  -h,       --help              Print this message.\n  -q,       --quiet             Don\'t print any message.\n  -v,       --version           Display flexloader version number.\n\n");
  }
  }
#line 61
  return;
}
}
#line 63 "/home/wslee/benchmarks/flexloader-0.03/src/main.c"
static void print_banner(void) 
{ 
  char *__cil_tmp1 ;
  char *__cil_tmp2 ;

  {
#line 65
  if (! quiet) {
    {
    {
#line 67
    printf((char const   */* __restrict  */)"flexloader version 0.03\n");
    }
    {
#line 68
    printf((char const   */* __restrict  */)"(C) 2005 Aurelien Jarno\n\n");
    }
    }
  }
#line 70
  return;
}
}
#line 77
int main(int argc , char **argv ) ;
#line 77 "/home/wslee/benchmarks/flexloader-0.03/src/main.c"
static struct option long_options[5]  = {      {"debug", 0, (int *)((void *)0), 'd'}, 
        {"help", 0, (int *)((void *)0), 'h'}, 
        {"quiet", 0, (int *)((void *)0), 'q'}, 
        {"version", 0, (int *)((void *)0), 'v'}, 
        {(char const   *)0, 0, (int *)0, 0}};
#line 72 "/home/wslee/benchmarks/flexloader-0.03/src/main.c"
int main(int argc , char **argv ) 
{ 
  int c ;
  int lindex ;
  int tmp ;
  char *__cil_tmp6 ;
  char *__cil_tmp7 ;
  char *__cil_tmp8 ;
  char *__cil_tmp9 ;

  {
#line 75
  lindex = 0;
  {
  {
#line 86
  while (1) {
    while_continue___0: /* CIL Label */ ;
    while_continue: /* CIL Label */ ;
    {
    {
#line 86
    c = getopt_long(argc, (char * const  *)argv, "dhqv", (struct option  const  *)(long_options),
                    & lindex);
    }
    }
#line 86
    if (! (c != -1)) {
#line 86
      goto while_break;
    }
    {
    {
#line 88
    printf((char const   */* __restrict  */)"%c\n", c);
    }
    }
    {
#line 91
    if (c == 100) {
#line 91
      goto case_100;
    }
#line 95
    if (c == 104) {
#line 95
      goto case_104;
    }
#line 101
    if (c == 113) {
#line 101
      goto case_113;
    }
#line 105
    if (c == 118) {
#line 105
      goto case_118;
    }
#line 110
    goto switch_default;
    case_100: /* CIL Label */ 
#line 92
    debug = 1;
#line 93
    goto switch_break;
    case_104: /* CIL Label */ 
    {
    {
#line 96
    print_banner();
    }
    {
#line 97
    print_usage();
    }
    {
#line 98
    exit(0);
    }
    }
#line 99
    goto switch_break;
    case_113: /* CIL Label */ 
#line 102
    quiet = 1;
#line 103
    goto switch_break;
    case_118: /* CIL Label */ 
    {
    {
#line 106
    print_banner();
    }
    {
#line 107
    exit(0);
    }
    }
#line 108
    goto switch_break;
    switch_default: /* CIL Label */ 
    {
    {
#line 111
    print_banner();
    }
    {
#line 112
    print_usage();
    }
    {
#line 113
    exit(1);
    }
    }
#line 114
    goto switch_break;
    switch_break: /* CIL Label */ ;
    }
  }
  while_break___0: /* CIL Label */ ;
  }
  while_break: /* CIL Label */ ;
  }
  {
  {
#line 118
  print_banner();
  }
  }
#line 119
  if (argc - optind != 2) {
    {
    {
#line 121
    print_usage();
    }
    {
#line 122
    exit(1);
    }
    }
  }
  {
  {
#line 126
  tmp = flex_download_program(*(argv + optind), *(argv + (optind + 1)));
  }
  }
#line 126
  if (tmp != 0) {
#line 128
    if (! quiet) {
      {
      {
#line 129
      printf((char const   */* __restrict  */)"Code NOT downloaded to the FPGA\n\n");
      }
      }
    }
  } else
#line 133
  if (! quiet) {
    {
    {
#line 134
    printf((char const   */* __restrict  */)"Code successfully downloaded to the FPGA\n\n");
    }
    }
  }
#line 137
  return (0);
}
}
#line 27 "/home/wslee/benchmarks/flexloader-0.03/src/byteblaster.h"
int open_byteblaster(char *devicename ) ;
#line 28
void close_byteblaster(int device ) ;
#line 29
void enable_byteblaster(int device , int value ) ;
#line 31
void set_DCLK(int device , int value ) ;
#line 32
void set_nCONFIG(int device , int value ) ;
#line 33
void set_DATA0(int device , int value ) ;
#line 35
int get_nSTATUS(int device ) ;
#line 36
int get_CONF_DONE(int device ) ;
#line 147 "/usr/include/stdio.h"
extern struct _IO_FILE *stderr ;
#line 333
extern int fprintf(FILE * __restrict  __stream , char const   * __restrict  __format 
                   , ...) ;
#line 819
extern void perror(char const   *__s ) ;
#line 73 "/usr/include/fcntl.h"
extern int ( __attribute__((__nonnull__(1))) open)(char const   *__file , int __oflag 
                                                   , ...) ;
#line 350 "/usr/include/unistd.h"
extern int close(int __fd ) ;
#line 456
extern int usleep(__useconds_t __useconds ) ;
#line 42 "/usr/include/sys/ioctl.h"
extern  __attribute__((__nothrow__)) int ioctl(int __fd , unsigned long __request 
                                               , ...) ;
#line 63 "/home/wslee/benchmarks/flexloader-0.03/src/byteblaster.c"
static void out_data(int device , unsigned char mask , unsigned char val ) ;
#line 63 "/home/wslee/benchmarks/flexloader-0.03/src/byteblaster.c"
static unsigned char data  =    (unsigned char)0;
#line 61 "/home/wslee/benchmarks/flexloader-0.03/src/byteblaster.c"
static void out_data(int device , unsigned char mask , unsigned char val ) 
{ 


  {
  {
#line 65
  data = (unsigned char )(((int )data & ~ ((int )mask)) | (int )val);
  {
#line 66
  ioctl(device, (unsigned long )(((1U << 30) | (unsigned int )(112 << 8)) | 134U) | (sizeof(unsigned char ) << 16),
        & data);
  }
  }
#line 67
  return;
}
}
#line 69 "/home/wslee/benchmarks/flexloader-0.03/src/byteblaster.c"
static void set_AUTOFEED(int device , int value ) 
{ 
  unsigned char control ;

  {
  {
  {
#line 73
  ioctl(device, (unsigned long )(((2U << 30) | (unsigned int )(112 << 8)) | 131U) | (sizeof(unsigned char ) << 16),
        & control);
  }
#line 74
  control = (unsigned char )((int )control & -3);
  }
#line 75
  if (value != 0) {
#line 76
    control = (unsigned char )((int )control | 2);
  }
  {
  {
#line 77
  ioctl(device, (unsigned long )(((1U << 30) | (unsigned int )(112 << 8)) | 132U) | (sizeof(unsigned char ) << 16),
        & control);
  }
  {
#line 78
  usleep((__useconds_t )100000);
  }
  }
#line 79
  return;
}
}
#line 81 "/home/wslee/benchmarks/flexloader-0.03/src/byteblaster.c"
static void set_D5(int device , int value ) 
{ 
  int tmp ;

  {
#line 84
  if (value != 0) {
#line 84
    tmp = 32;
  } else {
#line 84
    tmp = 0;
  }
  {
  {
#line 84
  out_data(device, (unsigned char)32, (unsigned char )tmp);
  }
  }
#line 85
  return;
}
}
#line 87 "/home/wslee/benchmarks/flexloader-0.03/src/byteblaster.c"
static int get_ACK(int device ) 
{ 
  unsigned char status ;

  {
  {
  {
#line 91
  ioctl(device, (unsigned long )(((2U << 30) | (unsigned int )(112 << 8)) | 129U) | (sizeof(unsigned char ) << 16),
        & status);
  }
  }
#line 92
  return (((int )status & 64) == 64);
}
}
#line 95 "/home/wslee/benchmarks/flexloader-0.03/src/byteblaster.c"
static int open_parport(char *device_name ) 
{ 
  int dev ;
  int tmp ;
  char *__cil_tmp4 ;
  char *__cil_tmp5 ;
  char *__cil_tmp6 ;
  char *__cil_tmp7 ;

  {
#line 99
  if (debug) {
    {
    {
#line 100
    printf((char const   */* __restrict  */)"Opening %s\n", device_name);
    }
    }
  }
  {
  {
#line 102
  dev = open((char const   *)device_name, 2);
  }
  }
#line 104
  if (dev < 0) {
#line 106
    if (! quiet) {
      {
      {
#line 107
      perror("open");
      }
      }
    }
#line 108
    return (-1);
  }
  {
  {
#line 110
  tmp = ioctl(dev, (unsigned long )((unsigned int )(112 << 8) | 139U));
  }
  }
#line 110
  if (tmp < 0) {
#line 112
    if (! quiet) {
      {
      {
#line 113
      perror("open");
      }
      }
    }
    {
    {
#line 114
    perror("ioctl");
    }
    {
#line 115
    close(dev);
    }
    }
#line 116
    return (-1);
  }
#line 119
  return (dev);
}
}
#line 122 "/home/wslee/benchmarks/flexloader-0.03/src/byteblaster.c"
static void close_parport(int device ) 
{ 


  {
#line 124
  if (device) {
    {
    {
#line 127
    ioctl(device, (unsigned long )((unsigned int )(112 << 8) | 140U));
    }
    {
#line 129
    close(device);
    }
    }
  }
#line 131
  return;
}
}
#line 133 "/home/wslee/benchmarks/flexloader-0.03/src/byteblaster.c"
static int detect_byteblaster(int device ) 
{ 
  int tmp ;
  int tmp___0 ;
  int tmp___1 ;
  char *__cil_tmp5 ;
  char *__cil_tmp6 ;
  char *__cil_tmp7 ;
  char *__cil_tmp8 ;
  char *__cil_tmp9 ;
  char *__cil_tmp10 ;
  char *__cil_tmp11 ;

  {
#line 135
  if (debug) {
    {
    {
#line 136
    printf((char const   */* __restrict  */)"Detecting byteblaster\n");
    }
    }
  }
#line 139
  if (debug) {
    {
    {
#line 140
    printf((char const   */* __restrict  */)"Driving D5 low\n");
    }
    }
  }
  {
  {
#line 141
  set_D5(device, 0);
  }
  {
#line 142
  usleep((__useconds_t )10000);
  }
  {
#line 143
  tmp = get_ACK(device);
  }
  }
#line 143
  if (tmp == 1) {
#line 145
    if (debug) {
      {
      {
#line 146
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"ACK stuck high\n");
      }
      }
    }
#line 147
    return (-1);
  }
#line 150
  if (debug) {
    {
    {
#line 151
    printf((char const   */* __restrict  */)"Driving D5 high\n");
    }
    }
  }
  {
  {
#line 152
  set_D5(device, 1);
  }
  {
#line 153
  usleep((__useconds_t )10000);
  }
  {
#line 154
  tmp___0 = get_ACK(device);
  }
  }
#line 154
  if (tmp___0 == 0) {
#line 156
    if (debug) {
      {
      {
#line 157
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"ACK stuck low\n");
      }
      }
    }
#line 158
    return (-1);
  }
#line 161
  if (debug) {
    {
    {
#line 162
    printf((char const   */* __restrict  */)"Driving D5 low\n");
    }
    }
  }
  {
  {
#line 163
  set_D5(device, 0);
  }
  {
#line 164
  usleep((__useconds_t )10000);
  }
  {
#line 165
  tmp___1 = get_ACK(device);
  }
  }
#line 165
  if (tmp___1 == 1) {
#line 167
    if (debug) {
      {
      {
#line 168
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"ACK stuck high\n");
      }
      }
    }
#line 169
    return (-1);
  }
#line 172
  return (0);
}
}
#line 182 "/home/wslee/benchmarks/flexloader-0.03/src/byteblaster.c"
int get_nSTATUS(int device ) 
{ 
  unsigned char status ;

  {
  {
  {
#line 186
  ioctl(device, (unsigned long )(((2U << 30) | (unsigned int )(112 << 8)) | 129U) | (sizeof(unsigned char ) << 16),
        & status);
  }
  }
#line 187
  return (((int )status & 16) == 16);
}
}
#line 190 "/home/wslee/benchmarks/flexloader-0.03/src/byteblaster.c"
int get_CONF_DONE(int device ) 
{ 
  unsigned char status ;

  {
  {
  {
#line 194
  ioctl(device, (unsigned long )(((2U << 30) | (unsigned int )(112 << 8)) | 129U) | (sizeof(unsigned char ) << 16),
        & status);
  }
  }
#line 195
  return (((int )status & 128) != 128);
}
}
#line 198 "/home/wslee/benchmarks/flexloader-0.03/src/byteblaster.c"
void set_DCLK(int device , int value ) 
{ 
  int tmp ;

  {
#line 201
  if (value != 0) {
#line 201
    tmp = 1;
  } else {
#line 201
    tmp = 0;
  }
  {
  {
#line 201
  out_data(device, (unsigned char)1, (unsigned char )tmp);
  }
  }
#line 202
  return;
}
}
#line 204 "/home/wslee/benchmarks/flexloader-0.03/src/byteblaster.c"
void set_nCONFIG(int device , int value ) 
{ 
  int tmp ;

  {
#line 207
  if (value != 0) {
#line 207
    tmp = 2;
  } else {
#line 207
    tmp = 0;
  }
  {
  {
#line 207
  out_data(device, (unsigned char)2, (unsigned char )tmp);
  }
  }
#line 208
  return;
}
}
#line 210 "/home/wslee/benchmarks/flexloader-0.03/src/byteblaster.c"
void set_DATA0(int device , int value ) 
{ 
  int tmp ;

  {
#line 213
  if (value != 0) {
#line 213
    tmp = 64;
  } else {
#line 213
    tmp = 0;
  }
  {
  {
#line 213
  out_data(device, (unsigned char)64, (unsigned char )tmp);
  }
  }
#line 214
  return;
}
}
#line 216 "/home/wslee/benchmarks/flexloader-0.03/src/byteblaster.c"
int open_byteblaster(char *devicename ) 
{ 
  int dev ;
  int tmp ;
  char *__cil_tmp4 ;
  char *__cil_tmp5 ;

  {
  {
  {
#line 220
  dev = open_parport(devicename);
  }
  }
#line 221
  if (dev < 0) {
#line 223
    if (! quiet) {
      {
      {
#line 224
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"Can\'t open %s!\n",
              devicename);
      }
      }
    }
#line 225
    return (-1);
  }
  {
  {
#line 228
  tmp = detect_byteblaster(dev);
  }
  }
#line 228
  if (tmp < 0) {
#line 230
    if (! quiet) {
      {
      {
#line 231
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"Byteblaster not found on %s!\n",
              devicename);
      }
      }
    }
    {
    {
#line 232
    close_byteblaster(dev);
    }
    }
#line 233
    return (-1);
  }
#line 236
  return (dev);
}
}
#line 239 "/home/wslee/benchmarks/flexloader-0.03/src/byteblaster.c"
void close_byteblaster(int device ) 
{ 


  {
  {
  {
#line 241
  enable_byteblaster(device, 0);
  }
  {
#line 242
  close_parport(device);
  }
  }
#line 243
  return;
}
}
#line 245 "/home/wslee/benchmarks/flexloader-0.03/src/byteblaster.c"
void enable_byteblaster(int device , int value ) 
{ 


  {
  {
  {
#line 247
  set_AUTOFEED(device, value);
  }
  }
#line 248
  return;
}
}
#line 357 "/usr/include/unistd.h"
extern ssize_t read(int __fd , void *__buf , size_t __nbytes ) ;
#line 48 "/home/wslee/benchmarks/flexloader-0.03/src/flexloader.c"
static int flex_config(int device ) 
{ 
  int t ;
  int tmp ;
  int tmp___0 ;
  int tmp___1 ;
  int tmp___2 ;
  char *__cil_tmp7 ;
  char *__cil_tmp8 ;
  char *__cil_tmp9 ;
  char *__cil_tmp10 ;
  char *__cil_tmp11 ;

  {
  {
  {
#line 52
  set_DCLK(device, 0);
  }
  {
#line 53
  set_DATA0(device, 1);
  }
  {
#line 54
  set_nCONFIG(device, 1);
  }
  {
#line 55
  enable_byteblaster(device, 1);
  }
  {
#line 56
  usleep((__useconds_t )100000);
  }
  }
#line 58
  if (debug) {
    {
    {
#line 59
    printf((char const   */* __restrict  */)"Configuring FLEX\n");
    }
    }
  }
#line 61
  t = 50;
  {
  {
#line 61
  while (1) {
    while_continue___3: /* CIL Label */ ;
    while_continue: /* CIL Label */ ;
#line 61
    if (! (t > 0)) {
#line 61
      goto while_break;
    }
    {
    {
#line 63
    tmp = get_nSTATUS(device);
    }
    }
#line 63
    if (tmp == 1) {
#line 64
      goto while_break;
    }
    {
    {
#line 65
    usleep((__useconds_t )10000);
    }
#line 61
    t --;
    }
  }
  while_break___3: /* CIL Label */ ;
  }
  while_break: /* CIL Label */ ;
  }
#line 67
  if (t == 0) {
#line 69
    if (! quiet) {
      {
      {
#line 70
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"nSTATUS != 1\n");
      }
      }
    }
#line 71
    return (-1);
  }
  {
  {
#line 74
  set_nCONFIG(device, 0);
  }
#line 76
  t = 50;
  }
  {
  {
#line 76
  while (1) {
    while_continue___4: /* CIL Label */ ;
    while_continue___0: /* CIL Label */ ;
#line 76
    if (! (t > 0)) {
#line 76
      goto while_break___0;
    }
    {
    {
#line 78
    tmp___0 = get_nSTATUS(device);
    }
    }
#line 78
    if (tmp___0 == 0) {
#line 79
      goto while_break___0;
    }
    {
    {
#line 80
    usleep((__useconds_t )10000);
    }
#line 76
    t --;
    }
  }
  while_break___4: /* CIL Label */ ;
  }
  while_break___0: /* CIL Label */ ;
  }
#line 82
  if (t == 0) {
#line 84
    if (! quiet) {
      {
      {
#line 85
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"nSTATUS != 0\n");
      }
      }
    }
#line 86
    return (-1);
  }
#line 89
  t = 50;
  {
  {
#line 89
  while (1) {
    while_continue___5: /* CIL Label */ ;
    while_continue___1: /* CIL Label */ ;
#line 89
    if (! (t > 0)) {
#line 89
      goto while_break___1;
    }
    {
    {
#line 91
    tmp___1 = get_CONF_DONE(device);
    }
    }
#line 91
    if (tmp___1 == 0) {
#line 92
      goto while_break___1;
    }
    {
    {
#line 93
    usleep((__useconds_t )10000);
    }
#line 89
    t --;
    }
  }
  while_break___5: /* CIL Label */ ;
  }
  while_break___1: /* CIL Label */ ;
  }
#line 95
  if (t == 0) {
#line 97
    if (! quiet) {
      {
      {
#line 98
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"CONF_DONE != 0\n");
      }
      }
    }
#line 99
    return (-1);
  }
  {
  {
#line 102
  set_nCONFIG(device, 1);
  }
#line 104
  t = 50;
  }
  {
  {
#line 104
  while (1) {
    while_continue___6: /* CIL Label */ ;
    while_continue___2: /* CIL Label */ ;
#line 104
    if (! (t > 0)) {
#line 104
      goto while_break___2;
    }
    {
    {
#line 106
    tmp___2 = get_nSTATUS(device);
    }
    }
#line 106
    if (tmp___2 == 1) {
#line 107
      goto while_break___2;
    }
    {
    {
#line 108
    usleep((__useconds_t )10000);
    }
#line 104
    t --;
    }
  }
  while_break___6: /* CIL Label */ ;
  }
  while_break___2: /* CIL Label */ ;
  }
#line 110
  if (t == 0) {
#line 112
    if (! quiet) {
      {
      {
#line 113
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"nSTATUS != 1\n");
      }
      }
    }
#line 114
    return (-1);
  }
  {
  {
#line 117
  usleep((__useconds_t )40000);
  }
  }
#line 118
  return (0);
}
}
#line 121 "/home/wslee/benchmarks/flexloader-0.03/src/flexloader.c"
static int flex_download(int device , int file ) 
{ 
  int byte ;
  int bit ;
  unsigned char data___1 ;
  ssize_t tmp ;
  int tmp___0 ;
  int tmp___1 ;
  char *__cil_tmp9 ;
  char *__cil_tmp10 ;
  char *__cil_tmp11 ;
  char *__cil_tmp12 ;
  char *__cil_tmp13 ;

  {
#line 126
  if (debug) {
    {
    {
#line 127
    printf((char const   */* __restrict  */)"Downloading code\n");
    }
    }
  }
#line 129
  byte = 0;
  {
  {
#line 129
  while (1) {
    while_continue___1: /* CIL Label */ ;
    while_continue: /* CIL Label */ ;
#line 131
    if (debug) {
      {
      {
#line 132
      printf((char const   */* __restrict  */)"Downloading byte %i\n", byte);
      }
      }
    }
    {
    {
#line 134
    tmp = read(file, (void *)(& data___1), (size_t )1);
    }
    }
#line 134
    if (tmp != 1) {
#line 136
      if (! quiet) {
        {
        {
#line 137
        fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"Unexpected end of file\n");
        }
        }
      }
#line 138
      return (-1);
    }
#line 141
    bit = 0;
    {
    {
#line 141
    while (1) {
      while_continue___2: /* CIL Label */ ;
      while_continue___0: /* CIL Label */ ;
#line 141
      if (! (bit < 8)) {
#line 141
        goto while_break___0;
      }
      {
      {
#line 143
      set_DATA0(device, (int )data___1 & 1);
      }
      {
#line 144
      set_DCLK(device, 1);
      }
      {
#line 145
      set_DCLK(device, 0);
      }
#line 146
      data___1 = (unsigned char )((int )data___1 >> 1);
      {
#line 148
      tmp___0 = get_nSTATUS(device);
      }
      }
#line 148
      if (tmp___0 == 0) {
#line 150
        if (! quiet) {
          {
          {
#line 151
          fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"Checksum error\n");
          }
          }
        }
#line 152
        return (-1);
      }
      {
      {
#line 155
      tmp___1 = get_CONF_DONE(device);
      }
      }
#line 155
      if (tmp___1 == 1) {
#line 157
        if (! quiet) {
          {
          {
#line 158
          printf((char const   */* __restrict  */)"%i bytes downloaded\n", byte);
          }
          }
        }
#line 159
        return (0);
      }
#line 141
      bit ++;
    }
    while_break___2: /* CIL Label */ ;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 129
    byte ++;
  }
  while_break___1: /* CIL Label */ ;
  }
  while_break: /* CIL Label */ ;
  }
}
}
#line 165 "/home/wslee/benchmarks/flexloader-0.03/src/flexloader.c"
static void flex_init(int device ) 
{ 
  int i ;
  char *__cil_tmp3 ;

  {
#line 169
  if (debug) {
    {
    {
#line 170
    printf((char const   */* __restrict  */)"Initializing FLEX\n");
    }
    }
  }
#line 173
  i = 0;
  {
  {
#line 173
  while (1) {
    while_continue___0: /* CIL Label */ ;
    while_continue: /* CIL Label */ ;
#line 173
    if (! (i < 10)) {
#line 173
      goto while_break;
    }
    {
    {
#line 175
    set_DCLK(device, 1);
    }
    {
#line 176
    set_DCLK(device, 0);
    }
#line 173
    i ++;
    }
  }
  while_break___0: /* CIL Label */ ;
  }
  while_break: /* CIL Label */ ;
  }
#line 178
  return;
}
}
#line 187 "/home/wslee/benchmarks/flexloader-0.03/src/flexloader.c"
int flex_download_program(char *device , char *rbf_file ) 
{ 
  int fd ;
  int byteblaster ;
  int tmp ;
  int tmp___0 ;
  char *__cil_tmp7 ;
  char *__cil_tmp8 ;
  char *__cil_tmp9 ;
  char *__cil_tmp10 ;
  char *__cil_tmp11 ;

  {
#line 192
  if (debug) {
    {
    {
#line 193
    printf((char const   */* __restrict  */)"Opening %s\n", rbf_file);
    }
    }
  }
  {
  {
#line 195
  fd = open((char const   *)rbf_file, 0);
  }
  }
#line 197
  if (fd < 0) {
#line 199
    if (! quiet) {
      {
      {
#line 201
      perror("open");
      }
      {
#line 202
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"Can\'t open %s!\n",
              rbf_file);
      }
      }
    }
#line 204
    return (-1);
  }
  {
  {
#line 207
  byteblaster = open_byteblaster(device);
  }
  }
#line 209
  if (byteblaster < 0) {
#line 210
    return (-1);
  }
  {
  {
#line 212
  tmp = flex_config(byteblaster);
  }
  }
#line 212
  if (tmp < 0) {
#line 214
    if (! quiet) {
      {
      {
#line 215
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"Altera FLEX not found!\n");
      }
      }
    }
#line 216
    return (-1);
  }
  {
  {
#line 219
  tmp___0 = flex_download(byteblaster, fd);
  }
  }
#line 219
  if (tmp___0 < 0) {
#line 221
    if (! quiet) {
      {
      {
#line 222
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"Download failed\n");
      }
      }
    }
#line 223
    return (-1);
  }
  {
  {
#line 226
  flex_init(byteblaster);
  }
  {
#line 228
  close_byteblaster(byteblaster);
  }
  {
#line 230
  close(fd);
  }
  }
#line 231
  return (0);
}
}
#line 63 "/home/wslee/benchmarks/flexloader-0.03/src/byteblaster.c"
static void out_data___0(int device , unsigned char mask , unsigned char val ) ;
#line 63 "/home/wslee/benchmarks/flexloader-0.03/src/byteblaster.c"
static unsigned char data___0  =    (unsigned char)0;
#line 61 "/home/wslee/benchmarks/flexloader-0.03/src/byteblaster.c"
static void out_data___0(int device , unsigned char mask , unsigned char val ) 
{ 


  {
  {
#line 65
  data___0 = (unsigned char )(((int )data___0 & ~ ((int )mask)) | (int )val);
  {
#line 66
  ioctl(device, (unsigned long )(((1U << 30) | (unsigned int )(112 << 8)) | 134U) | (sizeof(unsigned char ) << 16),
        & data___0);
  }
  }
#line 67
  return;
}
}
#line 69 "/home/wslee/benchmarks/flexloader-0.03/src/byteblaster.c"
static void set_AUTOFEED___0(int device , int value ) 
{ 
  unsigned char control ;

  {
  {
  {
#line 73
  ioctl(device, (unsigned long )(((2U << 30) | (unsigned int )(112 << 8)) | 131U) | (sizeof(unsigned char ) << 16),
        & control);
  }
#line 74
  control = (unsigned char )((int )control & -3);
  }
#line 75
  if (value != 0) {
#line 76
    control = (unsigned char )((int )control | 2);
  }
  {
  {
#line 77
  ioctl(device, (unsigned long )(((1U << 30) | (unsigned int )(112 << 8)) | 132U) | (sizeof(unsigned char ) << 16),
        & control);
  }
  {
#line 78
  usleep((__useconds_t )100000);
  }
  }
#line 79
  return;
}
}
#line 81 "/home/wslee/benchmarks/flexloader-0.03/src/byteblaster.c"
static void set_D5___0(int device , int value ) 
{ 
  int tmp ;

  {
#line 84
  if (value != 0) {
#line 84
    tmp = 32;
  } else {
#line 84
    tmp = 0;
  }
  {
  {
#line 84
  out_data___0(device, (unsigned char)32, (unsigned char )tmp);
  }
  }
#line 85
  return;
}
}
#line 87 "/home/wslee/benchmarks/flexloader-0.03/src/byteblaster.c"
static int get_ACK___0(int device ) 
{ 
  unsigned char status ;

  {
  {
  {
#line 91
  ioctl(device, (unsigned long )(((2U << 30) | (unsigned int )(112 << 8)) | 129U) | (sizeof(unsigned char ) << 16),
        & status);
  }
  }
#line 92
  return (((int )status & 64) == 64);
}
}
#line 95 "/home/wslee/benchmarks/flexloader-0.03/src/byteblaster.c"
static int open_parport___0(char *device_name ) 
{ 
  int dev ;
  int tmp ;
  char *__cil_tmp4 ;
  char *__cil_tmp5 ;
  char *__cil_tmp6 ;
  char *__cil_tmp7 ;

  {
#line 99
  if (debug) {
    {
    {
#line 100
    printf((char const   */* __restrict  */)"Opening %s\n", device_name);
    }
    }
  }
  {
  {
#line 102
  dev = open((char const   *)device_name, 2);
  }
  }
#line 104
  if (dev < 0) {
#line 106
    if (! quiet) {
      {
      {
#line 107
      perror("open");
      }
      }
    }
#line 108
    return (-1);
  }
  {
  {
#line 110
  tmp = ioctl(dev, (unsigned long )((unsigned int )(112 << 8) | 139U));
  }
  }
#line 110
  if (tmp < 0) {
#line 112
    if (! quiet) {
      {
      {
#line 113
      perror("open");
      }
      }
    }
    {
    {
#line 114
    perror("ioctl");
    }
    {
#line 115
    close(dev);
    }
    }
#line 116
    return (-1);
  }
#line 119
  return (dev);
}
}
#line 122 "/home/wslee/benchmarks/flexloader-0.03/src/byteblaster.c"
static void close_parport___0(int device ) 
{ 


  {
#line 124
  if (device) {
    {
    {
#line 127
    ioctl(device, (unsigned long )((unsigned int )(112 << 8) | 140U));
    }
    {
#line 129
    close(device);
    }
    }
  }
#line 131
  return;
}
}
#line 133 "/home/wslee/benchmarks/flexloader-0.03/src/byteblaster.c"
static int detect_byteblaster___0(int device ) 
{ 
  int tmp ;
  int tmp___0 ;
  int tmp___1 ;
  char *__cil_tmp5 ;
  char *__cil_tmp6 ;
  char *__cil_tmp7 ;
  char *__cil_tmp8 ;
  char *__cil_tmp9 ;
  char *__cil_tmp10 ;
  char *__cil_tmp11 ;

  {
#line 135
  if (debug) {
    {
    {
#line 136
    printf((char const   */* __restrict  */)"Detecting byteblaster\n");
    }
    }
  }
#line 139
  if (debug) {
    {
    {
#line 140
    printf((char const   */* __restrict  */)"Driving D5 low\n");
    }
    }
  }
  {
  {
#line 141
  set_D5___0(device, 0);
  }
  {
#line 142
  usleep((__useconds_t )10000);
  }
  {
#line 143
  tmp = get_ACK___0(device);
  }
  }
#line 143
  if (tmp == 1) {
#line 145
    if (debug) {
      {
      {
#line 146
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"ACK stuck high\n");
      }
      }
    }
#line 147
    return (-1);
  }
#line 150
  if (debug) {
    {
    {
#line 151
    printf((char const   */* __restrict  */)"Driving D5 high\n");
    }
    }
  }
  {
  {
#line 152
  set_D5___0(device, 1);
  }
  {
#line 153
  usleep((__useconds_t )10000);
  }
  {
#line 154
  tmp___0 = get_ACK___0(device);
  }
  }
#line 154
  if (tmp___0 == 0) {
#line 156
    if (debug) {
      {
      {
#line 157
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"ACK stuck low\n");
      }
      }
    }
#line 158
    return (-1);
  }
#line 161
  if (debug) {
    {
    {
#line 162
    printf((char const   */* __restrict  */)"Driving D5 low\n");
    }
    }
  }
  {
  {
#line 163
  set_D5___0(device, 0);
  }
  {
#line 164
  usleep((__useconds_t )10000);
  }
  {
#line 165
  tmp___1 = get_ACK___0(device);
  }
  }
#line 165
  if (tmp___1 == 1) {
#line 167
    if (debug) {
      {
      {
#line 168
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"ACK stuck high\n");
      }
      }
    }
#line 169
    return (-1);
  }
#line 172
  return (0);
}
}
#line 48 "/home/wslee/benchmarks/flexloader-0.03/src/flexloader.c"
static int flex_config___0(int device ) 
{ 
  int t ;
  int tmp ;
  int tmp___0 ;
  int tmp___1 ;
  int tmp___2 ;
  char *__cil_tmp7 ;
  char *__cil_tmp8 ;
  char *__cil_tmp9 ;
  char *__cil_tmp10 ;
  char *__cil_tmp11 ;

  {
  {
  {
#line 52
  set_DCLK(device, 0);
  }
  {
#line 53
  set_DATA0(device, 1);
  }
  {
#line 54
  set_nCONFIG(device, 1);
  }
  {
#line 55
  enable_byteblaster(device, 1);
  }
  {
#line 56
  usleep((__useconds_t )100000);
  }
  }
#line 58
  if (debug) {
    {
    {
#line 59
    printf((char const   */* __restrict  */)"Configuring FLEX\n");
    }
    }
  }
#line 61
  t = 50;
  {
  {
#line 61
  while (1) {
    while_continue___3: /* CIL Label */ ;
    while_continue: /* CIL Label */ ;
#line 61
    if (! (t > 0)) {
#line 61
      goto while_break;
    }
    {
    {
#line 63
    tmp = get_nSTATUS(device);
    }
    }
#line 63
    if (tmp == 1) {
#line 64
      goto while_break;
    }
    {
    {
#line 65
    usleep((__useconds_t )10000);
    }
#line 61
    t --;
    }
  }
  while_break___3: /* CIL Label */ ;
  }
  while_break: /* CIL Label */ ;
  }
#line 67
  if (t == 0) {
#line 69
    if (! quiet) {
      {
      {
#line 70
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"nSTATUS != 1\n");
      }
      }
    }
#line 71
    return (-1);
  }
  {
  {
#line 74
  set_nCONFIG(device, 0);
  }
#line 76
  t = 50;
  }
  {
  {
#line 76
  while (1) {
    while_continue___4: /* CIL Label */ ;
    while_continue___0: /* CIL Label */ ;
#line 76
    if (! (t > 0)) {
#line 76
      goto while_break___0;
    }
    {
    {
#line 78
    tmp___0 = get_nSTATUS(device);
    }
    }
#line 78
    if (tmp___0 == 0) {
#line 79
      goto while_break___0;
    }
    {
    {
#line 80
    usleep((__useconds_t )10000);
    }
#line 76
    t --;
    }
  }
  while_break___4: /* CIL Label */ ;
  }
  while_break___0: /* CIL Label */ ;
  }
#line 82
  if (t == 0) {
#line 84
    if (! quiet) {
      {
      {
#line 85
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"nSTATUS != 0\n");
      }
      }
    }
#line 86
    return (-1);
  }
#line 89
  t = 50;
  {
  {
#line 89
  while (1) {
    while_continue___5: /* CIL Label */ ;
    while_continue___1: /* CIL Label */ ;
#line 89
    if (! (t > 0)) {
#line 89
      goto while_break___1;
    }
    {
    {
#line 91
    tmp___1 = get_CONF_DONE(device);
    }
    }
#line 91
    if (tmp___1 == 0) {
#line 92
      goto while_break___1;
    }
    {
    {
#line 93
    usleep((__useconds_t )10000);
    }
#line 89
    t --;
    }
  }
  while_break___5: /* CIL Label */ ;
  }
  while_break___1: /* CIL Label */ ;
  }
#line 95
  if (t == 0) {
#line 97
    if (! quiet) {
      {
      {
#line 98
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"CONF_DONE != 0\n");
      }
      }
    }
#line 99
    return (-1);
  }
  {
  {
#line 102
  set_nCONFIG(device, 1);
  }
#line 104
  t = 50;
  }
  {
  {
#line 104
  while (1) {
    while_continue___6: /* CIL Label */ ;
    while_continue___2: /* CIL Label */ ;
#line 104
    if (! (t > 0)) {
#line 104
      goto while_break___2;
    }
    {
    {
#line 106
    tmp___2 = get_nSTATUS(device);
    }
    }
#line 106
    if (tmp___2 == 1) {
#line 107
      goto while_break___2;
    }
    {
    {
#line 108
    usleep((__useconds_t )10000);
    }
#line 104
    t --;
    }
  }
  while_break___6: /* CIL Label */ ;
  }
  while_break___2: /* CIL Label */ ;
  }
#line 110
  if (t == 0) {
#line 112
    if (! quiet) {
      {
      {
#line 113
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"nSTATUS != 1\n");
      }
      }
    }
#line 114
    return (-1);
  }
  {
  {
#line 117
  usleep((__useconds_t )40000);
  }
  }
#line 118
  return (0);
}
}
#line 121 "/home/wslee/benchmarks/flexloader-0.03/src/flexloader.c"
static int flex_download___0(int device , int file ) 
{ 
  int byte ;
  int bit ;
  unsigned char data___1 ;
  ssize_t tmp ;
  int tmp___0 ;
  int tmp___1 ;
  char *__cil_tmp9 ;
  char *__cil_tmp10 ;
  char *__cil_tmp11 ;
  char *__cil_tmp12 ;
  char *__cil_tmp13 ;

  {
#line 126
  if (debug) {
    {
    {
#line 127
    printf((char const   */* __restrict  */)"Downloading code\n");
    }
    }
  }
#line 129
  byte = 0;
  {
  {
#line 129
  while (1) {
    while_continue___1: /* CIL Label */ ;
    while_continue: /* CIL Label */ ;
#line 131
    if (debug) {
      {
      {
#line 132
      printf((char const   */* __restrict  */)"Downloading byte %i\n", byte);
      }
      }
    }
    {
    {
#line 134
    tmp = read(file, (void *)(& data___1), (size_t )1);
    }
    }
#line 134
    if (tmp != 1) {
#line 136
      if (! quiet) {
        {
        {
#line 137
        fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"Unexpected end of file\n");
        }
        }
      }
#line 138
      return (-1);
    }
#line 141
    bit = 0;
    {
    {
#line 141
    while (1) {
      while_continue___2: /* CIL Label */ ;
      while_continue___0: /* CIL Label */ ;
#line 141
      if (! (bit < 8)) {
#line 141
        goto while_break___0;
      }
      {
      {
#line 143
      set_DATA0(device, (int )data___1 & 1);
      }
      {
#line 144
      set_DCLK(device, 1);
      }
      {
#line 145
      set_DCLK(device, 0);
      }
#line 146
      data___1 = (unsigned char )((int )data___1 >> 1);
      {
#line 148
      tmp___0 = get_nSTATUS(device);
      }
      }
#line 148
      if (tmp___0 == 0) {
#line 150
        if (! quiet) {
          {
          {
#line 151
          fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"Checksum error\n");
          }
          }
        }
#line 152
        return (-1);
      }
      {
      {
#line 155
      tmp___1 = get_CONF_DONE(device);
      }
      }
#line 155
      if (tmp___1 == 1) {
#line 157
        if (! quiet) {
          {
          {
#line 158
          printf((char const   */* __restrict  */)"%i bytes downloaded\n", byte);
          }
          }
        }
#line 159
        return (0);
      }
#line 141
      bit ++;
    }
    while_break___2: /* CIL Label */ ;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 129
    byte ++;
  }
  while_break___1: /* CIL Label */ ;
  }
  while_break: /* CIL Label */ ;
  }
}
}
#line 165 "/home/wslee/benchmarks/flexloader-0.03/src/flexloader.c"
static void flex_init___0(int device ) 
{ 
  int i ;
  char *__cil_tmp3 ;

  {
#line 169
  if (debug) {
    {
    {
#line 170
    printf((char const   */* __restrict  */)"Initializing FLEX\n");
    }
    }
  }
#line 173
  i = 0;
  {
  {
#line 173
  while (1) {
    while_continue___0: /* CIL Label */ ;
    while_continue: /* CIL Label */ ;
#line 173
    if (! (i < 10)) {
#line 173
      goto while_break;
    }
    {
    {
#line 175
    set_DCLK(device, 1);
    }
    {
#line 176
    set_DCLK(device, 0);
    }
#line 173
    i ++;
    }
  }
  while_break___0: /* CIL Label */ ;
  }
  while_break: /* CIL Label */ ;
  }
#line 178
  return;
}
}
#line 51 "/home/wslee/benchmarks/flexloader-0.03/src/main.c"
static void print_usage___0(void) 
{ 
  char *__cil_tmp1 ;

  {
  {
  {
#line 53
  printf((char const   */* __restrict  */)"Usage: flexloader parport_device rbf_file\n\nValid options are:\n  -d,       --debug             Print debug messages.\n  -h,       --help              Print this message.\n  -q,       --quiet             Don\'t print any message.\n  -v,       --version           Display flexloader version number.\n\n");
  }
  }
#line 61
  return;
}
}
#line 63 "/home/wslee/benchmarks/flexloader-0.03/src/main.c"
static void print_banner___0(void) 
{ 
  char *__cil_tmp1 ;
  char *__cil_tmp2 ;

  {
#line 65
  if (! quiet) {
    {
    {
#line 67
    printf((char const   */* __restrict  */)"flexloader version 0.03\n");
    }
    {
#line 68
    printf((char const   */* __restrict  */)"(C) 2005 Aurelien Jarno\n\n");
    }
    }
  }
#line 70
  return;
}
}
#line 77 "/home/wslee/benchmarks/flexloader-0.03/src/main.c"
static struct option long_options___0[5]  = {      {"debug", 0, (int *)((void *)0), 'd'}, 
        {"help", 0, (int *)((void *)0), 'h'}, 
        {"quiet", 0, (int *)((void *)0), 'q'}, 
        {"version", 0, (int *)((void *)0), 'v'}, 
        {(char const   *)0, 0, (int *)0, 0}};
